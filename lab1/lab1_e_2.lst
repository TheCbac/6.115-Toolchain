     1              org 00h               ; Reset vector
     2  0000 020100   ljmp main          ; Jump to user entry point
     3                  
     4                  
     5              org 100h              ; main entry point at 100h
     6              main:       
     7  0100 120113   lcall init          ; initialize the serial port
     8                loop:               ; infiinte loop
     9  0103 120120     lcall getchr      ; get a character fomr the serial port
    10  0106 7808       mov R0, #08h
    11  0108 B50003     cjne A, 0, nbs
    12  010B 120132     lcall backspace
    13                  nbs:
    14  010E 12012A     lcall putchr      ; echo that character right back
    15  0111 80F0       sjmp loop           
    16                  
    17                  
    18              init:
    19                  ; assume 11.0592 Mhz Clock
    20                  ; user TIMER1 to create a 9600 baude connection
    21  0113 758920   mov tmod, #20h
    22  0116 758840   mov tcon, #40h
    23  0119 758DFD   mov th1,  #0FDh
    24  011C 759850   mov scon, #50h
    25  011F 22       ret
    26                  
    27              getchr:
    28                  ; This routine receives characters from the UART
    29                  ; jnb is bitwise jmp if bit not set
    30  0120 3098FD   jnb RI, getchr  ; wait until the rx interrupt flag is set
    31  0123 E599     mov A, sbuf     ; move the character into the accumulator
    32  0125 547F     anl A, #7fh      ; clear 8th bit (since this should be ASCII)
    33  0127 C298     clr RI          ; clear the intterupt flag
    34  0129 22       ret
    35                  
    36                  
    37              putchr:
    38  012A C299     clr scon.1          ; Clear the transmit done flag
    39  012C F599     mov sbuf, a
    40                txloop:
    41  012E 3099FD     jnb TI, txloop    ; Wait until the character is actually sent
    42  0131 22         ret
    43                  
    44              backspace:
    45  0132 120148   lcall escape  ; escape sequence
    46  0135 7431     mov A, #31h   ; put 1
    47  0137 12012A   lcall putchr  
    48  013A 7444     mov A, #44h   ; put D
    49  013C 12012A   lcall putchr
    50                  
    51  013F 120148   lcall escape ; escape sequence
    52  0142 744B     mov A, #4Bh   ; put K
    53  0144 12012A   lcall putchr
    54  0147 22       ret
    55                  
    56              escape:
    57  0148 741B     mov A, #1bh ; escape char
    58  014A 12012A   lcall putchr
    59  014D 745B     mov A, #5bh ; [ character
    60  014F 12012A   lcall putchr
    61  0152 22       ret
    62                  
    63                  


